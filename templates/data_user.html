<!-- home/quan05/doan/templates/data_user.html -->
{% extends "base.html" %}
{% block title %}Xem H·ªì s∆° - EHR ABE Demo{% endblock %}

{% block head %}
<style>
.search-panel {
    background-color: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 30px;
}
.results-list { list-style: none; padding: 0; }
.result-item {
    background: #ffffff;
    border: 1px solid #e9ecef;
    border-left: 5px solid #3498db;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 15px;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    gap: 15px;
}
.result-item .info { flex-grow: 1; }
.result-item p { margin: 0 0 8px 0; }
.result-item code {
    background-color: #e9ecef;
    padding: 3px 6px;
    border-radius: 4px;
    font-family: monospace;
    color: #c0392b;
}
</style>
{% endblock %}

{% block content %}
<h2>üë§ Truy c·∫≠p H·ªì s∆° B·ªánh √°n</h2>

{% if session.user.role == 'doctor' %}
    <div class="search-panel">
        <h4>T√¨m ki·∫øm H·ªì s∆°</h4>
        <p>V·ªõi vai tr√≤ b√°c sƒ©, b·∫°n c√≥ th·ªÉ t√¨m ki·∫øm c√°c h·ªì s∆° trong h·ªá th·ªëng. Nh·∫•n n√∫t d∆∞·ªõi ƒë√¢y ƒë·ªÉ t·∫£i danh s√°ch.</p>
        <form method="POST" action="{{ url_for('user.data_user') }}">
            <button class="btn btn-primary" type="submit">üîç T√¨m t·∫•t c·∫£ H·ªì s∆°</button>
        </form>
    </div>
{% elif session.user.role == 'patient' %}
    <div class="search-panel">
        <h4>H·ªì s∆° B·ªánh √°n c·ªßa b·∫°n</h4>
        <p>Ch√†o <strong>{{ session.user.name }}</strong>, ƒë√¢y l√† danh s√°ch c√°c h·ªì s∆° b·ªánh √°n c·ªßa b·∫°n ƒë∆∞·ª£c l∆∞u tr√™n h·ªá th·ªëng.</p>
    </div>
{% endif %}

{% if results is defined %}
    <h3 style="margin-top: 20px;">
        {% if results %}
            K·∫øt qu·∫£:
        {% else %}
            Kh√¥ng t√¨m th·∫•y h·ªì s∆° n√†o.
        {% endif %}
    </h3>
    <ul class="results-list">
        {% for record in results %}
            <li class="result-item">
                <div class="info">
                    <p><strong>ID H·ªì s∆°:</strong> {{ record._id }}</p>
                    <p><strong>B·ªánh nh√¢n:</strong> {{ record.patient_name }}</p>
                    <p><strong>Ch√≠nh s√°ch truy c·∫≠p:</strong> <code>{{ record.access_policy }}</code></p>
                </div>
                <div class="actions">
                    <form action="{{ url_for('user.decrypt_record') }}" method="POST" style="display:inline;">
                        <input type="hidden" name="doc_id" value="{{ record._id }}">
                        <button type="submit" class="btn btn-success">üîë Gi·∫£i m√£</button>
                    </form>
                </div>
            </li>
        {% endfor %}
    </ul>
{% endif %}
{% endblock %}